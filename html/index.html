<!Doctype html>

<html lang="en">
    
    <head>
        
     <meta charset="utf-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1">
         
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
                        
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
        
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/locale/it.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
     </head>
     <body>
        
        
        
        <div class="header">
            <h1 class="text-center">Ultimi valori raccolti</h1>
            </div>
        
                <div class="container">
                <div class="row">
                    
                    <div class="col-md-10">
                        <h2 class="text-center">Postazione 1</h2>
                        <canvas id="post_1"></canvas>
                        </div>
                    <div class="col-md-2">
                    <div class="row">
                    <h2 class="text-center">Valori Medi</h2>
            </div>
            <div class="row">
                
                <span class="btn btn-primary" style="width: 180px"> Temperatura<br>
                    <span class="badge badge-light"><div id="tempM1"></div></span>
                </span>
            </div>
            <div class="row">
            <span class="btn btn-success" style="width: 180px"> Umidità dell'aria<br>
            <span class="badge badge-light"><div id="humidM1"></div></span>
            </span>
            </div>


          <div class="row">
              <span class="btn btn-danger" style="width: 180px"> Umidità del suolo<br>
                  <span class="badge badge-light"><div id="hygroM1"></div></span>
              </span>
      </div>

      <<div class="input-group">
        <div class="input-group-prepend">
            <div class="row">
                <h3 class="text-center">Data Inizio</h3>

        </div>
      </div>

<input type="date" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">
    <div class="input-group-prepend">
<div class="row">
<br>
<h3 class="text-center">Data Fine</h3>
      	</div>
      </div>
    <input type="date" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">
</div>
      
            </div>
            </div>
                
                </div>
                
                <!--     <div class="row">
                 <h2 class="text-center">Valori</h2>
                 <div class="col-md-12">
                 <canvas id="post_2"></canvas>
                 </div>
                 </div>
                 -->
                </div>
                
                <div class="row">
                    <div class="col-md-10">
                        <h2 class="text-center">Postazione 2</h2>
                        <canvas id="post_2"></canvas>
                    </div>
                </div>

<div class="row">
    <div class="col-md-10">
        <h2 class="text-center">Postazione 3</h2>
        <canvas id="post_3"></canvas>
    </div>
</div>

                
                
        <script>

  var socket = io();

  var temp1  = new Array(); 
  var temp2  = new Array(); 
  var temp3  = new Array(); 
  var tempS  = new Array();

  var humid1  = new Array(); 
  var humid2  = new Array(); 
  var humid3  = new Array(); 

  var hygro1  = new Array(); 
  var hygro2  = new Array(); 
  var hygro3  = new Array(); 

//  temp1  = [ [], [] ]; 
  temp1  = [ [], []];
  temp2  = [ [], []]; 
  temp3  = [ [], []]; 
  tempS  = [ [], []];
  pTemp1  = [];


  humid1  = [ [], []];
  humid2  = [ [], []]; 
  humid3  = [ [], []]; 


  hygro1  = [ [], []];
  hygro2  = [ [], []]; 
  hygro3  = [ [], []]; 

 // console.log(temp2);

 
  socket.on('temp', function(data){
            var Nel = data.length;

	data.forEach(function (record){
                 var Nel = record.length;
                 
	var dataAcq = new Date(record.data);
	//per record intendiamo ogni elemento del vettore 
	if(record.postazione==1) {       
//		console.log("il valore arriva così:");
//		console.log(moment(record.t));
		var nuovoDato = { 
//		    x: (moment(dataAcq).format("DD/MM/YY HH:mm")),
		    x: dataAcq,
		    y: Number(record.temperature),
		    r:2
		 };

		pTemp1.push(nuovoDato);
//		console.log(record.temperature);
		temp1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
		temp1[1].push(Number(record.temperature));
	}else if(record.postazione==2){       
//		console.log(moment(record.t).format("DD/MM/YY HH:mm"));
//		console.log(record.temperature);
		temp2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
		temp2[1].push(Number(record.temperature));
/*		var nuovoDato = { 
		    x: dataAcq,
		    y: Number(record.temperature)
		 };

		temp2.push(nuovoDato);
*/
	}else if(record.postazione==3){
//		console.log(moment(record.t).format("DD/MM/YY HH:mm"));
//		console.log(record.temperature);
		temp3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
		temp3[1].push(parseInt(record.temperature));



	}else{       
//		console.log(moment(record.t).format("DD/MM/YY HH:mm"));
//		console.log(record.temperature);
		tempS[0].push(dataAcq);
		tempS[1].push(Number(record.temperature));

	}
	});	
var tempM1=0;
            temp1[1].forEach(function (record){

                             tempM1 = tempM1 + record;
});
            tempM1 = tempM1/Nel;
            document.getElementById("tempM1").innerHTML = tempM1;

            chart1.update();
            chart2.update();
            chart3.update();

});

 socket.on('humid', function(data){
           var Nel = data.length;

	data.forEach(function (record){
		
	

	var dataAcq = new Date(record.data);
	//per record intendiamo ogni elemento del vettore 
	if(record.postazione==1) {       

		humid1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
		humid1[1].push(Number(record.humidity));
	}else if(record.postazione==2){       
//		console.log(moment(record.t).format("DD/MM/YY HH:mm"));
//		console.log(record.temperature);
		humid2[0].push(dataAcq);
		humid2[1].push(Number(record.humidity));

	}else if(record.postazione==3){
//		console.log(moment(record.t).format("DD/MM/YY HH:mm"));
//		console.log(record.temperature);
		humid3[0].push(dataAcq);
		humid3[1].push(parseInt(record.humidity));
	}

	});	
           //    console.log("humid 1 è:" + humid1);
           //    console.log("humid 2 è:" + humid2);
           //    console.log("humid 3 è:" + humid3);

           var humidM1=0;
           humid1[1].forEach(function (record){
                             humidM1 = humidM1 + record;
                             });
           humidM1=humidM1/Nel;
           document.getElementById("humidM1").innerHTML = humidM1;

           chart1.update();
           chart2.update();
           chart3.update();

           
           });


 socket.on('hygro', function(data){
           
           var Nel = data.length;
	
           data.forEach(function (record){

	var dataAcq = new Date(record.data);
	//per record intendiamo ogni elemento del vettore 
	if(record.postazione==1) {       

		hygro1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
		hygro1[1].push(Number(record.hygroThermal));
	
    }else if(record.postazione==2){

                        hygro2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                        hygro2[1].push(Number(record.hygroThermal));
                        
	}else if(record.postazione==3){
                        
                 hygro3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                 hygro3[1].push(parseInt(record.hygroThermal));
	}

	});
           //    console.log("humid 1 è:" + humid1);
           //    console.log("humid 2 è:" + humid2);
           //    console.log("humid 3 è:" + humid3);

           var hygroM1=0;
           
           hygro1[1].forEach(function (record){

                             hygroM1 = hygroM1 + record;


});
           hygroM1 = hygroM1/Nel;

           document.getElementById("hygroM1").innerHTML = hygroM1;

           chart1.update();
           chart2.update();
           chart3.update();
});
           socket.on('hygro', function(data){

                var Nel = data.length;
                     data.forEach(function (record){

                var dataAcq = new Date(record.data);
                                  //per record intendiamo ogni elemento del vettore
                                  if(record.postazione==1) {

                                  
                hygro1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                                  hygro1[1].push(Number(record.hygroThermal));

                                  
                                  }else if(record.postazione==2){
                                  hygro2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                                  hygro2[1].push(Number(record.hygroThermal));
                                  
                                  }else if(record.postazione==3){
                                  hygro3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                                  hygro3[1].push(parseInt(record.hygroThermal));
                                  }
                                  });

                     var hygroM1=0;
                     hygro1[1].forEach(function (record){
                                       hygroM1 = hygroM1 + record;
                                       });
                     hygroM1 = hygroM1/Nel;
                     document.getElementById("hygroM1").innerHTML = hygroM1;
                     chart1.update();
                     chart2.update();
                     chart3.update();
                     });
                     
                     socket.on('newData', function(record){
                               console.log(record);
                               console.log(Date(record.data));
                               var dataAcq = new Date(record.data);

                               temp1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               humid1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               hygro1[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));

                               temp2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               humid2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               hygro2[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));

                               temp3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               humid3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));
                               hygro3[0].push(moment(dataAcq).format("DD/MM/YY HH:mm"));

                               if(record.postazione==1) {
                               temp1[1].push(Number(record.temperature));
                               humid1[1].push(Number(record.humidity));
                               hygro1[1].push(parseInt(record.hygroThermal));

                               var pElTemp1 = temp1[1].shift();
                               var pElhumid1 = humid1[1].shift();
                               var pElhygro1 = hygro1[1].shift();
                               chart1.update();

                               }else if(record.postazione==2){
                               temp2[1].push(Number(record.temperature));
                               humid2[1].push(Number(record.humidity));
                               hygro2[1].push(parseInt(record.hygroThermal));

                               var pElTemp2 = temp2[1].shift();
                               var pElhumid2 = humid2[1].shift();
                               var pElhygro2 = hygro2[1].shift();

                               chart2.update();
                               }else if(record.postazione==3){
                               temp3[1].push(Number(record.temperature));
                               humid3[1].push(Number(record.humidity));
                               hygro3[1].push(parseInt(record.hygroThermal));

                               var pElTemp3 = temp3[1].shift();
                               var pElhumid3 = humid3[1].shift();
                               var pElhygro3 = hygro3[1].shift();

                               chart3.update();
                               }
                               });

           
var ctx1 = document.getElementById('post_1').getContext('2d');
var chart1 = new Chart(ctx1, {
    // The type of chart we want to create
    type: 'line',

 
    data: {
        labels: temp1[0],
        datasets: [{
            label: "temperatura",
//            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'blue',
            data: temp1[1],
	    yAxisID: 'first-y-axis'
        },{
            label: "Umidità dell'aria",
 //           backgroundColor: 'red',
            borderColor: 'red',
            data: humid1[1],
	    yAxisID: 'second-y-axis'
        },{
            label: "Umidità del terreno",
 //           backgroundColor: 'red',
            borderColor: 'green',
            data: hygro1[1],
	    yAxisID: 'second-y-axis'
        }]
    },


    // Configuration options go here
    options: {
//	      
   	scales: {
            yAxes: [{
                id: 'first-y-axis',
                type: 'linear',
		position: 'left'
            }, {
                id: 'second-y-axis',
                type: 'linear',
		position: 'right'
            }]
        }
    }
});



var ctx2 = document.getElementById('post_2').getContext('2d');
var chart2 = new Chart(ctx2, {
    // The type of chart we want to create
    type: 'line',

    //tipo di dato per chart bubble
//    data: pTemp1,

//     The data for our dataset
    data: {
        labels: temp2[0],
        datasets: [{
            label: "temperatura",
//            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'blue',
            data: temp2[1],
	    yAxisID: 'first-y-axis'
        },{
            label: "Umidità dell'aria",
 //           backgroundColor: 'red',
            borderColor: 'red',
            data: humid2[1],
	    yAxisID: 'second-y-axis'
        },{
            label: "Umidità del terreno",
 //           backgroundColor: 'red',
            borderColor: 'green',
            data: hygro2[1],
	    yAxisID: 'second-y-axis'
        }]
    },


    // Configuration options go here
    options: {
//	      
   	scales: {
            yAxes: [{
                id: 'first-y-axis',
                type: 'linear',
		position: 'left'
            }, {
                id: 'second-y-axis',
                type: 'linear',
		position: 'right'
            }]
        }
    }
});



var ctx3 = document.getElementById('post_3').getContext('2d');
var chart3 = new Chart(ctx3, {
    // The type of chart we want to create
    type: 'line',

    //tipo di dato per chart bubble
//    data: pTemp1,

//     The data for our dataset
    data: {
        labels: temp3[0],
        datasets: [{
            label: "temperatura",
//            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'blue',
            data: temp3[1],
	    yAxisID: 'first-y-axis'
        },{
            label: "Umidità dell'aria",
 //           backgroundColor: 'red',
            borderColor: 'red',
            data: humid3[1],
	    yAxisID: 'second-y-axis'
        },{
            label: "Umidità del terreno",
 //           backgroundColor: 'red',
            borderColor: 'green',
            data: hygro3[1],
	    yAxisID: 'second-y-axis'
        }]
    },


    // Configuration options go here
    options: {
//	      
   	scales: {
            yAxes: [{
                id: 'first-y-axis',
                type: 'linear',
		position: 'left'
            }, {
                id: 'second-y-axis',
                type: 'linear',
		position: 'right'
            }]
        }
    }
});

          </script>
        </body>
       </html>
